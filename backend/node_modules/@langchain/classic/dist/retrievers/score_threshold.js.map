{"version":3,"file":"score_threshold.js","names":["input: ScoreThresholdRetrieverInput<V>","query: string","filteredResults: [Document, number][]","vectorStore: V","options: Omit<ScoreThresholdRetrieverInput<V>, \"vectorStore\">"],"sources":["../../src/retrievers/score_threshold.ts"],"sourcesContent":["import { Document } from \"@langchain/core/documents\";\nimport {\n  VectorStore,\n  VectorStoreRetriever,\n  VectorStoreRetrieverInput,\n} from \"@langchain/core/vectorstores\";\n\nexport type ScoreThresholdRetrieverInput<V extends VectorStore> = Omit<\n  VectorStoreRetrieverInput<V>,\n  \"k\"\n> & {\n  maxK?: number;\n  kIncrement?: number;\n  minSimilarityScore: number;\n};\n\nexport class ScoreThresholdRetriever<\n  V extends VectorStore,\n> extends VectorStoreRetriever<V> {\n  minSimilarityScore: number;\n\n  kIncrement = 10;\n\n  maxK = 100;\n\n  constructor(input: ScoreThresholdRetrieverInput<V>) {\n    super(input);\n    this.maxK = input.maxK ?? this.maxK;\n    this.minSimilarityScore =\n      input.minSimilarityScore ?? this.minSimilarityScore;\n    this.kIncrement = input.kIncrement ?? this.kIncrement;\n  }\n\n  async invoke(query: string): Promise<Document[]> {\n    let currentK = 0;\n    let filteredResults: [Document, number][] = [];\n    do {\n      currentK += this.kIncrement;\n      const results = await this.vectorStore.similaritySearchWithScore(\n        query,\n        currentK,\n        this.filter\n      );\n      filteredResults = results.filter(\n        ([, score]) => score >= this.minSimilarityScore\n      );\n    } while (filteredResults.length >= currentK && currentK < this.maxK);\n    return filteredResults.map((documents) => documents[0]).slice(0, this.maxK);\n  }\n\n  static fromVectorStore<V extends VectorStore>(\n    vectorStore: V,\n    options: Omit<ScoreThresholdRetrieverInput<V>, \"vectorStore\">\n  ) {\n    return new this<V>({ ...options, vectorStore });\n  }\n}\n"],"mappings":";;;;;;AAgBA,IAAa,0BAAb,cAEU,qBAAwB;CAChC;CAEA,aAAa;CAEb,OAAO;CAEP,YAAYA,OAAwC;EAClD,MAAM,MAAM;EACZ,KAAK,OAAO,MAAM,QAAQ,KAAK;EAC/B,KAAK,qBACH,MAAM,sBAAsB,KAAK;EACnC,KAAK,aAAa,MAAM,cAAc,KAAK;CAC5C;CAED,MAAM,OAAOC,OAAoC;EAC/C,IAAI,WAAW;EACf,IAAIC,kBAAwC,CAAE;AAC9C,KAAG;GACD,YAAY,KAAK;GACjB,MAAM,UAAU,MAAM,KAAK,YAAY,0BACrC,OACA,UACA,KAAK,OACN;GACD,kBAAkB,QAAQ,OACxB,CAAC,GAAG,MAAM,KAAK,SAAS,KAAK,mBAC9B;EACF,SAAQ,gBAAgB,UAAU,YAAY,WAAW,KAAK;AAC/D,SAAO,gBAAgB,IAAI,CAAC,cAAc,UAAU,GAAG,CAAC,MAAM,GAAG,KAAK,KAAK;CAC5E;CAED,OAAO,gBACLC,aACAC,SACA;AACA,SAAO,IAAI,KAAQ;GAAE,GAAG;GAAS;EAAa;CAC/C;AACF"}